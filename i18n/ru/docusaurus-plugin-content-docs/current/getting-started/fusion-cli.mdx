# Слияние CLI

<AppliesTo all />
Интегрируйте напрямую с помощью интерфейса командной строки.

Если для вашего языка еще нет встроенной библиотеки или привязок командной строки, вы можете напрямую интегрировать Velopack с помощью командной строки.

**_Необходимы два двоичных файла._**

## Слияние

`Vfusion.exe` / `VfusionMac` / `VFusionNix`<br/>
Обеспечивает поддержку получения текущей версии, проверки наличия обновлений, загрузки обновлений и т. д.

:::warning
В настоящее время двоичный файл fusion не распространяется автоматически, и вам необходимо скопировать его в выходной каталог компилятора. 
Вы можете загрузить [артефакт недавней сборки] \(https://github.com/velopack/velopack.fusion/actions) и убедиться, что он скопирован в выходной каталог во время сборки.
:::

### Пример

```
> Проверка Vfusion.exe --url https://the.place/you-host/updates
```

Вот возможные результаты:

- **Обновления недоступны:** пустой стандартный вывод и `exitCode == 0`.
- **Неустранимая ошибка:** пустой стандартный вывод и `exitCode != 0`. Будет создан [файл журнала](#logging).
- **Доступно обновление:** стандартный вывод содержит объект json и `exitCode == 0`.

Когда обновление станет доступным, вы получите объект [UpdateInfo](../reference/cs/Velopack/UpdateInfo.md) через стандартный вывод:

```json
{
    "isDowngrade": false,
    "targetFullRelease": {
        "packageId": "YourPackageId",
        "version": "2.0.1",
        "type": "Full", 
        "fileName": "YourPackageId-2.0.1-full.nupkg",
        "sha1": "331a4f44a6a875b2ce139ae0c9ce5bb5e1ec0d97",
        "size": 90654,
        "notesMarkdown": "# Release v2.0.1 \n Your message here",
        "notesHtml": "<h1>Release v2.0.1</h2><br/>Your message here"
    }
}
```

Следующим шагом будет загрузка обновления на диск, используя свойство fileName из предыдущей команды:

```
> Загрузка Vfusion.exe \
    --url https://the.place/you-host/updates \
    --name YourPackageId-2.0.1-full.nupkg
```

Во время выполнения этой команды fusion выведет текущий прогресс загрузки на стандартный вывод. Например:

```
10
20
30
40
...
```

Вы можете проанализировать каждую строку стандартного вывода (разделенную на `\n`) и показать прогресс своим пользователям.

Если `exitCode == 0`, команда выполнена успешно.

Чтобы получить окончательный путь к загруженному ресурсу, вы можете объединить результаты `Vfusion.exe get-packages` и `fileName`.

Чтобы установить обновление, обратитесь к следующему разделу.

:::tip
Существуют и другие команды (например, `get-version`), которые могут быть полезны, изучите их с помощью `Vfusion.exe -h`
:::

## Программа обновлений

`Update.exe` / `UpdateMac` / `UpdateNix`<br/>
Обеспечивает поддержку установки загруженных обновлений, запрос на повышение прав (при необходимости), загрузку [зависимостей]\(../packaging/bootstrapping. mdx) и так далее.

:::info
Этот двоичный файл автоматически копируется в ваш пакет при сборке `vpk`, вам просто нужно расположить его относительно вашего основного исполняемого файла.
:::

Вы будете использовать команду update apply для установки загруженного обновления.

### Пример

```
> Update.exe применить --перезапустить
```

Выполнение приведенной выше команды немедленно закроет вашу программу, установит обновление и перезапустит приложение в новой версии.

:::tip
При вызове без аргументов Update применит новейшую загруженную версию, если она новее установленной в данный момент версии. 
Если вы хотите установить более старую версию, вам необходимо указать параметр --package.
:::

Все доступные варианты подачи заявки приведены ниже:

```
update apply:
Применяет поэтапное/подготовленное обновление, при необходимости устанавливая необходимые среды выполнения
  -r, --restart Перезапустить приложение после обновления
  -w, --wait Дождитесь родительский процесс должен завершиться перед применением обновления
      --waitPid <PID>   Дождитесь завершения указанного процесса перед применением обновления
  -p, --package <FILE>  Update пакет для применения
  -h, --help Распечатать справку
  [EXE_ARGS]... Аргументы для передачи перезапускаемому исполняемому файлу. Перед ним должен стоять '--'.
```

## Ведение журнала

Поскольку ошибки не выводятся на стандартный вывод, важно знать, где найти файлы журналов для диагностики ошибок.

### Окна

Программа обновления выполнит вход в свой собственный каталог, а Fusion — в папку над собой. 
При типичной установке это приведет к объединению журналов Fusion и журнала Updater в один файл журнала.

### Линукс и МакОС

В UNIX-подобных операционных системах журналы этих двоичных файлов всегда хранятся в `/tmp/velopack.log`.
