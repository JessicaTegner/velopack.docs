name: Generate Reference Pages

on:
  schedule:
    - cron: '0 0 * * *' # every day at midnight
  workflow_dispatch:

permissions:
  contents: write
  id-token: write

jobs:
  vpk-cli:
    strategy:
      matrix:
        os: [macos-latest, ubuntu-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Generate CLI Reference
        working-directory: generator
        run: dotnet run -- cli refout
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: cli-${{ matrix.os }}
          path: generator/refout/*
  generate:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Generate
        working-directory: generator
        run: dotnet run
      - uses: caesay/wait-artifact-action@master
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          max_wait_seconds: 900
          artifacts: cli-macos-latest,cli-ubuntu-latest
      - name: Download Artifacts
        uses: actions/download-artifact@v4
        with:
          path: docs/reference/cli/content
          pattern: cli-*
          merge-multiple: true
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: output
          path: docs/reference/*
      # - name: test
      #   run: ls -la docs/reference/cli/content
   